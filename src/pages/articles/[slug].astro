---
import Giscus from "../../components/Giscus.astro";
import { type CollectionEntry, getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import FormattedDate from "../../components/FormattedDate.astro";

export async function getStaticPaths() {
	const posts = await getCollection("articles");
	return posts.map((post) => ({
		params: { slug: post.slug },
		props: post,
	}));
}
type Props = CollectionEntry<"articles">;

const post = Astro.props;
const { Content } = await post.render();
---

<BaseLayout title={post.data.title} description={post.data.description}>
	<article class="max-w-[65ch] mx-auto">
		<header class="mb-12 text-center">
			<h1 class="text-4xl font-serif font-bold mb-4 leading-tight">
				{post.data.title}
			</h1>
			<div
				class="flex flex-col sm:flex-row justify-between items-center sm:items-end gap-4 mt-6 text-sm font-mono text-secondary"
			>
				{
					post.data.tags && (
						<div class="flex flex-wrap gap-2 justify-center sm:justify-start">
							{post.data.tags.map((tag) => (
								<a
									href={`/tags/${tag}`}
									class="hover:text-accent"
								>
									#{tag}
								</a>
							))}
						</div>
					)
				}
				<FormattedDate date={post.data.date} class="shrink-0" />
			</div>
		</header>
		<div class="prose prose-lg font-serif mx-auto">
			<Content />
		</div>

		<div class="mt-16 pt-16 border-t border-border">
			<h3
				class="text-sm font-semibold uppercase tracking-wider text-secondary mb-8"
			>
				Discussion
			</h3>
			<Giscus />
		</div>
	</article>
</BaseLayout>
